<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Путь героя — фан-справочник</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#05070a;
  --card:#0b1220;
  --border:#1e88ff;
  --accent:#ff9800;
  --text:#e8f0ff;
  --muted:#9fb4d8;
  --locked: rgba(255,255,255,0.08);
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#0a1020,#05070a 60%);
  color:var(--text);
  font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Arial,sans-serif;
  line-height:1.5;
  font-weight:700;
  -webkit-font-smoothing:antialiased;
}
header{
  background:#05070a;
  border-bottom:3px solid var(--border);
  padding:18px;
  text-align:center;
}
header h1{
  font-family:'Press Start 2P',monospace;
  color:var(--accent);
  font-size:20px;
  margin:0;
}
.header-row{
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
  margin-top:12px;
  flex-wrap:wrap;
}
.subtitle{color:var(--muted);font-size:12px;margin-top:6px;font-weight:700}
.warning{color:#ff5252;font-size:12px;margin-top:6px;font-weight:700}

/* tabs */
.tabs{ display:flex; justify-content:center; gap:12px; margin-top:12px; flex-wrap:wrap; }
.tab{ font-family:'Press Start 2P',monospace; background:var(--card); border:2px solid var(--border); color:var(--text); padding:8px 14px; border-radius:12px; cursor:pointer; transition:.15s; font-weight:700; }
.tab:hover{box-shadow:0 0 12px rgba(30,136,255,.25)}
.tab.active{ background:rgba(30,136,255,.12); box-shadow:0 0 12px rgba(30,136,255,.35); color:var(--accent) }

/* settings button */
.settingsBtn{ background:var(--card); border:2px solid var(--border); color:var(--text); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:700; }
.settingsPanel{ display:none; max-width:720px; margin:12px auto 0; padding:12px; border:2px solid var(--border); border-radius:12px; background:linear-gradient(180deg,#061529,#05101a); color:var(--muted); font-weight:700; }
.settingsPanel.active{ display:block; }

/* main */
main{ max-width:1100px; margin:16px auto; padding:14px; }

/* controls */
.controls{ display:flex; gap:12px; justify-content:center; margin-bottom:18px; flex-wrap:wrap; }
input[type="text"], select, input[type="search"]{ background:#070b14; border:2px solid var(--border); color:var(--text); padding:10px 14px; border-radius:12px; font-size:14px; font-weight:700; }

/* grid/cards */
.grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:18px; }
.card, .item-card, .prestige-card, .achievement-card{ background:linear-gradient(180deg,#0d162a,var(--card)); border:2px solid var(--border); border-radius:14px; padding:16px; box-shadow:0 8px 25px rgba(0,0,0,0.45); font-weight:700; }
.card h3, .item-card h3, .prestige-card h3, .achievement-card h3{ font-family:'Press Start 2P',monospace; color:var(--accent); font-size:13px; margin:0 0 8px 0; font-weight:700; }
.world{ font-size:12px; color:var(--muted); margin-bottom:8px; }
.stat{ font-size:13px; margin-bottom:6px; color:var(--text); font-weight:700; }

/* fan text */
.fan-desc{ margin-top:10px; font-size:12px; color:var(--muted); font-weight:600; }
.fan-secret{ margin-top:6px; font-size:12px; color:#cbe9ff; font-weight:700; }

/* items grid */
.items-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:14px; margin-top:10px; }

/* footer */
footer{ margin-top:26px; padding:12px; border-top:2px solid var(--border); text-align:center; color:var(--muted); font-weight:700; }

/* small helpers */
.disclaimer{ font-size:12px; color:#ffd6a8; margin-top:8px; font-weight:700; }
.hidden{ display:none !important; }

/* achievements locked/unlocked */
.achievement-locked{ opacity:0.45; background:linear-gradient(180deg,#081025,var(--locked)); border-style:dashed; }
.achievement-unlocked{ box-shadow:0 6px 18px rgba(0,0,0,0.6); border-color: #6be38a; }
.small{ font-size:12px; color:var(--muted); font-weight:700; margin-top:8px; }
.code-input{ display:flex; gap:8px; margin-top:8px; align-items:center; }
.code-input input{ flex:1; }
.btn{ background:var(--card); border:2px solid var(--border); color:var(--text); padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700; }
</style>
</head>
<body>

<header>
  <h1>Путь героя — фан-справочник</h1>
  <div class="subtitle">Сервер Лололошки • мобы, предметы, престижа</div>
  <div class="warning">⚠ САЙТ НЕ ОФИЦИАЛЬНЫЙ</div>

  <div class="header-row">
    <nav class="tabs" role="navigation" aria-label="Вкладки">
      <button class="tab active" data-tab="mobs">Мобы</button>
      <button class="tab" data-tab="items">Предметы</button>
      <button class="tab" data-tab="prestige">Престиж</button>
      <button class="tab" data-tab="achievements">Достижения</button>
    </nav>

    <button id="openSettings" class="settingsBtn" title="Настройки">⚙ Настройки</button>
  </div>

  <div id="settingsPanel" class="settingsPanel" aria-hidden="true">
    <label style="display:flex;align-items:center;gap:10px;">
      <input id="fanModeToggle" type="checkbox" style="transform:scale(1.05);"/>
      <span>Включить режим «Тайны мира» (фан-описания и секреты)</span>
    </label>

    <label style="display:flex;align-items:center;gap:10px;margin-top:10px;">
      <input id="showAchievementsToggle" type="checkbox" style="transform:scale(1.05);"/>
      <span>Показывать вкладку «Достижения»</span>
    </label>

    <div style="margin-top:12px">
      <div style="font-weight:700;margin-bottom:6px">Ввести код (каждый код даёт достижение)</div>
      <div class="code-input">
        <input id="promoCodeInput" type="text" placeholder="Введите код..." aria-label="Код достижения" />
        <button id="promoApplyBtn" class="btn">Активировать</button>
      </div>
      <div id="codeMessage" class="small" style="margin-top:8px;color:var(--muted)"></div>
    </div>

    <div style="margin-top:12px">
      <div style="font-weight:700;margin-bottom:6px">Подтверждение — «Я написал в бота»</div>
      <button id="confirmMessagedBot" class="btn">Я написал в бота</button>
      <div class="small" style="margin-top:8px;color:var(--muted)">Нажмите, если вы действительно написали в @YoutubeHopper_bot — достижение «помощник» будет выдано.</div>
    </div>

    <div class="disclaimer">
      Внимание: фан-режим показывает фан-описания и секреты — это не официальный лор сервера.
    </div>
    <div style="margin-top:10px;color:var(--muted)">Режимы, достижения и использованные коды сохраняются в браузере.</div>
  </div>
</header>

<main>
  <!-- MOBS TAB -->
  <section id="tab-mobs" class="tab-content active">
    <div class="controls">
      <input id="search" type="search" placeholder="Поиск по имени…" aria-label="Поиск мобов"/>
      <select id="worldFilter" aria-label="Выбор мира">
        <option value="all">Все миры</option>
        <option value="Даливарика">Даливарика</option>
        <option value="Миср">Миср</option>
        <option value="Алотерра">Алотерра</option>
        <option value="Междумирье">Междумирье</option>
      </select>
    </div>

    <div id="cards" class="grid" aria-live="polite"></div>
  </section>

  <!-- ITEMS TAB -->
  <section id="tab-items" class="tab-content">
    <h2>Предметы</h2>
    <div class="items-grid" id="itemGrid"></div>
  </section>

  <!-- PRESTIGE TAB -->
  <section id="tab-prestige" class="tab-content">
    <h2>Престиж</h2>
    <div class="prestige-card">
      <h3>1 уровень престижа</h3>
      <ul>
        <li>Урон: 1x → 1.15x</li>
        <li>Защита: 1x → 1.15x</li>
        <li>Здоровье: 1x → 1.15x</li>
        <li>Регенерация: 1x → 1.16x</li>
        <li>Скорость: 1x → 1x</li>
        <li>Золото: 1x → 2.9x</li>
        <li>Опыт: 1x → 2.9x</li>
      </ul>

      <h3>2 уровень престижа</h3>
      <ul>
        <li>Урон: 1.15x → 1.32x</li>
        <li>Защита: 1.15x → 1.31x</li>
        <li>Здоровье: 1.15x → 1.32x</li>
        <li>Регенерация: 1.16x → 1.33x</li>
        <li>Скорость: 1x → 1x</li>
        <li>Золото: 2.9x → 8.41x</li>
        <li>Опыт: 2.9x → 8.41x</li>
      </ul>

      <h3>3 уровень престижа</h3>
      <ul>
        <li>Урон: 1.32x → 1.52x</li>
        <li>Защита: 1.31x → 1.5x</li>
        <li>Здоровье: 1.32x → 1.52x</li>
        <li>Регенерация: 1.33x → 1.54x</li>
        <li>Скорость: 1x → 1x</li>
        <li>Золото: 8.41x → 24.39x</li>
        <li>Опыт: 8.41x → 24.39x</li>
      </ul>

      <p style="margin-top:10px;color:var(--muted)">В будущем будут добавлены уровни 4 и далее.</p>
    </div>
  </section>

  <!-- ACHIEVEMENTS TAB -->
  <section id="tab-achievements" class="tab-content">
    <h2>Достижения</h2>
    <div id="achievementsGrid" class="items-grid"></div>
    <div id="achievementsInfo" class="small"></div>
  </section>
</main>

<footer>
  <div>Есть доп. информация или ошибки — писать в Telegram-бота</div>
  <div><a href="https://t.me/YoutubeHopper_bot" target="_blank">@YoutubeHopper_bot</a></div>
</footer>

<script>
/* =========================
   Данные (мобы/предметы/достижения)
   ========================= */

/* mobs: порядок Даливарика -> Миср -> Алотерра -> Междумирье (6 в каждой) */
const enemies = [
  // Даливарика (6)
  { world:'Даливарика', order:1, name:'Нежить', drops:['Свиток «Шлем Тёмного Рыцаря» — 6%','Вороной герб — 10%','Сломанная кость — 10%'], fan:'Древняя нежить, фан-легенда.' },
  { world:'Даливарика', order:2, name:'Векс', drops:['Свиток «Ботинки Тёмного Рыцаря» — 6%','Осколок чёрного металла — 10%','Фрагмент папируса — 10%'], fan:'Сумрачный охотник, фан-описание.' },
  { world:'Даливарика', order:3, name:'Поборник', drops:['Свиток «Штаны Тёмного Рыцаря» — 6%','Вороной герб — 10%','Камушек — 10%'], fan:'Воин старых времён, фан-история.' },
  { world:'Даливарика', order:4, name:'Природный элементаль', drops:['Свиток «Кираса Тёмного Рыцаря» — 6%','Осколок чёрного металла — 10%','Вороной герб — 10%','Сломанная кость — 10%','Фрагмент папируса — 10%','Камушек — 10%'], fan:'Дух земли, фан-описание.' },
  { world:'Даливарика', order:5, name:'Гримуар', drops:['Свиток «Шлем Тёмного Рыцаря»','Свиток «Ботинки Тёмного Рыцаря»','Свиток «Штаны Тёмного Рыцаря»','Свиток «Кираса Тёмного Рыцаря»','Осколок чёрного металла — 14%','Вороной герб — 14%','Сломанная кость — 14%','Фрагмент папируса — 14%','Камушек — 14%'], fan:'Магический том, фан-легенда.' },
  { world:'Даливарика', order:6, name:'Спектральный некромант', drops:['Свиток «Шлем Тёмного Рыцаря»','Свиток «Ботинки Тёмного Рыцаря»','Свиток «Штаны Тёмного Рыцаря»','Свиток «Кираса Тёмного Рыцаря»','Осколок чёрного металла — 20%','Вороной герб — 20%','Сломанная кость — 20%','Фрагмент папируса — 20%','Камушек — 20%'], fan:'Повелитель теней, фан-миф.' },

  // Миср (6)
  { world:'Миср', order:1, name:'Городской разбойник', drops:['Свиток «Шлем Повелителя Песков» — 6%','Песчинка всевластия — 10%','Рунная плита — 10%'], fan:'Житель рыночных улиц, фан-история.' },
  { world:'Миср', order:2, name:'Тоифэтун', drops:['Свиток «Ботинки Повелителя Песков» — 6%','Сердце Джинна — 10%','Аметистовый кристалл — 10%'], fan:'Джиновая тварь, фан-легенда.' },
  { world:'Миср', order:3, name:'Кристаллический жук', drops:['Свиток «Штаны Повелителя Песков» — 6%','Песчинка всевластия — 10%','Клочок шёлка — 10%'], fan:'Крошечный носитель кристаллов, фан-описание.' },
  { world:'Миср', order:4, name:'Пещерный скорпион', drops:['Свиток «Кираса Повелителя Песков» — 6%','Сердце Джинна — 10%','Песчинка всевластия — 10%','Аметистовый кристалл — 10%','Рунная плита — 10%','Клочок шёлка — 10%'], fan:'Охранник подземелий, фан-история.' },
  { world:'Миср', order:5, name:'Чудовище', drops:['Свиток «Шлем Повелителя Песков»','Свиток «Ботинки Повелителя Песков»','Свиток «Штаны Повелителя Песков»','Свиток «Кираса Повелителя Песков»','Сердце Джинна — 14%','Песчинка всевластия — 14%','Аметистовый кристалл — 14%','Рунная плита — 14%','Клочок шёлка — 14%'], fan:'Глубинный гигант, фан-легенда.' },
  { world:'Миср', order:6, name:'Отверженный', drops:['Свиток «Шлем Повелителя Песков»','Свиток «Ботинки Повелителя Песков»','Свиток «Штаны Повелителя Песков»','Свиток «Кираса Повелителя Песков»','Сердце Джинна — 20%','Песчинка всевластия — 20%','Аметистовый кристалл — 20%','Рунная плита — 20%','Клочок шёлка — 20%'], fan:'Потерянная душа пустыни, фан-описание.' },

  // Алотерра (6)
  { world:'Алотерра', order:1, name:'Имперский полицейский', drops:['Свиток «Шлем Инспектора Империи» — 5%','Первичная материя — 7%','Мини-реактор — 7%'], fan:'Механо-страж империи, фан-описание.' },
  { world:'Алотерра', order:2, name:'Имперский пёс', drops:['Свиток «Ботинки Инспектора Империи» — 5%','Сгусток неизвестной субстанции — 7%','Технопластина — 7%'], fan:'Биозверь стражи, фан-легенда.' },
  { world:'Алотерра', order:3, name:'Автономный бот', drops:['Свиток «Штаны Инспектора Империи» — 5%','Микросхема — 7%','Мини-реактор — 7%'], fan:'Разведчик империи, фан-описание.' },
  { world:'Алотерра', order:4, name:'ΑΠΜ-ΤΑΡAH', drops:['Свиток «Кираса Инспектора Империи» — 5%','Мини-реактор — 10%','Технопластина — 10%','Микросхема — 10%','Сгусток неизвестной субстанции — 10%','Первичная Материя — 10%'], fan:'Экспериментальный дрон, фан-миф.' },
  { world:'Алотерра', order:5, name:'АПМ-ХИЩНИК', drops:['Мини-реактор — 14%','Технопластина — 14%','Микросхема — 14%','Сгусток неизвестной субстанции — 14%','Первичная Материя — 14%'], fan:'Боевой механический зверь, фан-описание.' },
  { world:'Алотерра', order:6, name:'АПМ-ЖАЛО', drops:['Мини-реактор — 17%','Технопластина — 17%','Микросхема — 17%','Сгусток неизвестной субстанции — 17%','Первичная Материя — 17%'], fan:'Дрон-жало, фан-легенда.' },

  // Междумирье (6)
  { world:'Междумирье', order:1, name:'Убийца', drops:['Свиток «Шлем Странника Пустоты» — 4%','Кристалл скинта — 6%','Лоскут бездны — 6%'], fan:'Холодный ассасин из разломов, фан-описание.' },
  { world:'Междумирье', order:2, name:'Призрачный олень', drops:['Свиток «Ботинки Странника Пустоты» — 4%','Ядро междумирья — 6%','Сингулярная жемчужина — 6%'], fan:'Эфирное существо, фан-легенда.' },
  { world:'Междумирье', order:3, name:'Наблюдатель', drops:['Свиток «Штаны Странника Пустоты» — 4%','Лоскут бездны — 6%','Осколок бездны — 6%'], fan:'Следящий за потоками реальности, фан-описание.' },
  { world:'Междумирье', order:4, name:'Скорпион', drops:['Свиток «Кираса Странника Пустоты» — 4%','Лоскут бездны — 8%','Осколок бездны — 8%','Сингулярная жемчужина — 8%'], fan:'Пустынный хищник из разломов, фан-легенда.' },
  { world:'Междумирье', order:5, name:'Страж', drops:['Лоскут бездны — 13%','Осколок бездны — 13%','Сингулярная жемчужина — 13%','Ядро междумирья — 13%','Кристалл скинта — 13%'], fan:'Огромный хранитель энергии мира, фан-описание.' },
  { world:'Междумирье', order:6, name:'Хранитель', drops:['Лоскут бездны — 15%','Осколок бездны — 15%','Сингулярная жемчужина — 15%','Ядро междумирья — 15%','Кристалл скинта — 15%'], fan:'Последний защитник реликвий, фан-легенда.' }
];

/* items (id, name, desc) */
const items = [
  { id:'helm', name:'Свиток «Шлем»', desc:'Часть сета — шлем, даёт защиту.' },
  { id:'boots', name:'Свиток «Ботинки»', desc:'Снижает время передвижения.' },
  { id:'pants', name:'Свиток «Штаны»', desc:'Увеличивает выносливость.' },
  { id:'chest', name:'Свиток «Кираса»', desc:'Большая защита против физ. урона.' },
  { id:'minireactor', name:'Мини-реактор', desc:'Источник энергии для механизмов.' },
  { id:'techplate', name:'Технопластина', desc:'Используется для крафта роботов.' },
  { id:'chip', name:'Микросхема', desc:'Компонент для высоких технологий.' },
  { id:'blob', name:'Сгусток неизвестной субстанции', desc:'Странный материал, нужен для исследований.' },
  { id:'core', name:'Ядро междумирья', desc:'Мощный энергетический компонент.' },
  { id:'pearl', name:'Сингулярная жемчужина', desc:'Редкий артефакт междумирья.' },
  { id:'skindust', name:'Кристалл скинта', desc:'Фрагмент с экзотической материи.' },
  { id:'shard', name:'Осколок бездны', desc:'Осколок, имеющий магические свойства.' },
  { id:'cloth', name:'Лоскут бездны', desc:'Ткань, пропитанная энергией.' },
  { id:'psand', name:'Песчинка всевластия', desc:'Редкий ресурс Мисра.' },
  { id:'heart', name:'Сердце Джинна', desc:'Магический компонент джина.' },
  { id:'amethyst', name:'Аметистовый кристалл', desc:'Кристалл магической энергии.' },
  { id:'rune', name:'Рунная плита', desc:'Древний артефакт с рунами.' },
  { id:'silk', name:'Клочок шёлка', desc:'Материал для одежды.' }
];

/* achievements: existing a1..a40 + s1..s10 (secret)
   добавляем коды-ачивки a41..a45 и админ/помощник a46,a47 */
const achievements = [
  /* ... (оставляем прежние 40 + 10 секретов) */
  // Для компактности вставим короткий набор — в реале можно описать все подробно:
  { id:'a1', name:'Первый взгляд', req:'Просмотреть любую карточку моба' },
  { id:'a2', name:'Первые предметы', req:'Открыть карточку любого предмета' },
  { id:'a3', name:'Миролюб', req:'Переключиться на вкладку Престиж' },
  { id:'a4', name:'Исследователь мира', req:'Посмотреть 6 разных мобов' },
  { id:'a5', name:'Коллекционер предметов', req:'Открыть 5 разных предметов' },
  { id:'a6', name:'Шопоголик', req:'Открыть все предметы' },
  { id:'a7', name:'Фан-гость', req:'Включить фан-режим' },
  { id:'a8', name:'Настройщик', req:'Открыл панель настроек' },
  { id:'a9', name:'Поисковый', req:'Выполнить поиск по любому слову' },
  { id:'a10', name:'Фильтратор', req:'Применить фильтр мира' },

  { id:'a11', name:'Вкладочник', req:'Открыть 10 разных мобов' },
  { id:'a12', name:'Мастер вкладок', req:'Переключиться между вкладками 10 раз' },
  { id:'a13', name:'Полноправ', req:'Посмотреть всех мобов одной локации' },
  { id:'a14', name:'Исследователь всех', req:'Просмотреть 12 уникальных мобов' },
  { id:'a15', name:'Легендопоиск', req:'Посмотреть 18 уникальных мобов' },
  { id:'a16', name:'Почитатель престижа', req:'Дойти до вкладки Престиж 5 раз' },
  { id:'a17', name:'Шаман', req:'Открыть фан-описание 5 мобов' },
  { id:'a18', name:'Картограф', req:'Просмотреть все миры в фильтре' },
  { id:'a19', name:'Гуру крафта', req:'Открыть 10 предметов' },
  { id:'a20', name:'Писарь', req:'Прочитать 5 фан-описаний' },

  { id:'a21', name:'Полный список', req:'Просмотреть всех 24 моба' },
  { id:'a22', name:'Коллекционер', req:'Открыть все предметы' },
  { id:'a23', name:'Тайный читатель', req:'Включить фан-режим и прочитать 10 фан-описаний' },
  { id:'a24', name:'Серфер', req:'Использовать поиск 5 раз' },
  { id:'a25', name:'Фильтр-мастер', req:'Применить фильтр 10 раз' },
  { id:'a26', name:'Кликер', req:'Кликнуть 50 раз по карточкам' },
  { id:'a27', name:'Дипломат', req:'Посмотреть каждую вкладку хотя бы раз' },
  { id:'a28', name:'Архивариус', req:'Открыть все предметы и мобов по 1' },
  { id:'a29', name:'Открытие', req:'Найти скрытую кнопку настроек' },
  { id:'a30', name:'Подсказчик', req:'Прочитать 20 фан-описаний' },

  { id:'a31', name:'Найс Трип', req:'Фильтр -> Поиск -> Клик (цепочка действий)' },
  { id:'a32', name:'Обозреватель', req:'Провести на странице 5 минут' },
  { id:'a33', name:'Скороход', req:'Переключиться на вкладку Мобы и обратно 20 раз' },
  { id:'a34', name:'Собиратель знаний', req:'Открыть 30 уникальных карточек (мобы/предметы)' },
  { id:'a35', name:'Тестер', req:'Проверить все фильтры' },
  { id:'a36', name:'Хранитель', req:'Сохранить настройки (fan/achievements)' },
  { id:'a37', name:'Генератор', req:'Выполнить 100 кликов на странице' },
  { id:'a38', name:'Мастер штурма', req:'Открыть настройки 10 раз' },
  { id:'a39', name:'Аналитик', req:'Выполнить 20 поисков' },
  { id:'a40', name:'Прочти всё', req:'Прочитать все описания предметов' },

  // code achievements (будут выдаваться при вводе кода)
  { id:'a41', name:'Код: support', req:'Активировать код поддержки (скрыт в интерфейсе)' },
  { id:'a42', name:'Код: loofan', req:'Активировать код loofan' },
  { id:'a43', name:'Код: achievements', req:'Активировать код achievements' },
  { id:'a44', name:'Код: Hopper736', req:'Активировать код Hopper736' },
  { id:'a45', name:'Код: (будет добавлен)', req:'Активировать пятый код' },

  // admin/helper achievements
  { id:'a46', name:'Админ', req:'Ввод кода special (code hop) даёт это достижение' },
  { id:'a47', name:'Помощник', req:'Подтвердите, что написали в бота — достижение выдано' },

  // 10 секретных достижений (без видимых условий)
  { id:'s1', name:'Секрет 1', secret:true },
  { id:'s2', name:'Секрет 2', secret:true },
  { id:'s3', name:'Секрет 3', secret:true },
  { id:'s4', name:'Секрет 4', secret:true },
  { id:'s5', name:'Секрет 5', secret:true },
  { id:'s6', name:'Секрет 6', secret:true },
  { id:'s7', name:'Секрет 7', secret:true },
  { id:'s8', name:'Секрет 8', secret:true },
  { id:'s9', name:'Секрет 9', secret:true },
  { id:'s10', name:'Секрет 10', secret:true }
];

/* =========================
   Состояние и localStorage
   ========================= */
const STORAGE = {
  FAN:'hero_fan_v1',
  SHOW_ACH:'hero_show_ach_v1',
  UNLOCK:'hero_unlocked_v1',
  USED_CODES:'hero_used_codes_v1',
  VIEWED_MOBS:'hero_viewed_mobs_v1',
  VIEWED_ITEMS:'hero_viewed_items_v1',
  CLICK_COUNT:'hero_clicks_v1'
};

let fanMode = localStorage.getItem(STORAGE.FAN) === 'true';
let showAchievements = localStorage.getItem(STORAGE.SHOW_ACH) === 'true';
let unlocked = JSON.parse(localStorage.getItem(STORAGE.UNLOCK) || '[]');
let usedCodes = new Set(JSON.parse(localStorage.getItem(STORAGE.USED_CODES) || '[]'));
let viewedMobs = new Set(JSON.parse(localStorage.getItem(STORAGE.VIEWED_MOBS) || '[]'));
let viewedItems = new Set(JSON.parse(localStorage.getItem(STORAGE.VIEWED_ITEMS) || '[]'));
let clickCount = Number(localStorage.getItem(STORAGE.CLICK_COUNT) || 0);
let tabSwitchCount = Number(localStorage.getItem('hero_tab_switch_count') || 0);
let settingsOpenCount = Number(localStorage.getItem('hero_settings_open_count') || 0);

/* =========================
   Коды (не отображаются в UI)
   - НЕ ПИШИТЕ КОДЫ В ОТКРЫТЫЙ ТЕКСТ!
   =========================
   Здесь — список допустимых кодов и соответствующих достижений.
   Не выводим их в интерфейс.
*/
const codeMap = {
  'support': 'a41',
  'loofan': 'a42',
  'achievements': 'a43',
  'Hopper736': 'a44',
  // a45 оставлен для добавления кода позднее — можно установить вручную здесь
  // 'yourcode5': 'a45'
};

// отдельный "админский" код (по условию пользователя)
const adminCode = 'code hop'; // ввод этого кода выдаёт достижение 'a46'

/* =========================
   DOM refs
   ========================= */
const openSettingsBtn = document.getElementById('openSettings');
const settingsPanel = document.getElementById('settingsPanel');
const fanModeToggle = document.getElementById('fanModeToggle');
const showAchievementsToggle = document.getElementById('showAchievementsToggle');
const cardsEl = document.getElementById('cards');
const searchEl = document.getElementById('search');
const worldFilterEl = document.getElementById('worldFilter');
const itemsGridEl = document.getElementById('itemGrid');
const achievementsGridEl = document.getElementById('achievementsGrid');
const achievementsInfoEl = document.getElementById('achievementsInfo');
const promoInput = document.getElementById('promoCodeInput');
const promoBtn = document.getElementById('promoApplyBtn');
const codeMessage = document.getElementById('codeMessage');
const confirmMessagedBot = document.getElementById('confirmMessagedBot');

/* =========================
   Инициализация UI значений
   ========================= */
fanModeToggle.checked = fanMode;
showAchievementsToggle.checked = showAchievements;
updateAchievementsTabVisibility();

/* =========================
   Сохранение состояния
   ========================= */
function saveState(){
  localStorage.setItem(STORAGE.FAN, fanMode ? 'true' : 'false');
  localStorage.setItem(STORAGE.SHOW_ACH, showAchievements ? 'true' : 'false');
  localStorage.setItem(STORAGE.UNLOCK, JSON.stringify(unlocked));
  localStorage.setItem(STORAGE.USED_CODES, JSON.stringify(Array.from(usedCodes)));
  localStorage.setItem(STORAGE.VIEWED_MOBS, JSON.stringify(Array.from(viewedMobs)));
  localStorage.setItem(STORAGE.VIEWED_ITEMS, JSON.stringify(Array.from(viewedItems)));
  localStorage.setItem(STORAGE.CLICK_COUNT, String(clickCount));
  localStorage.setItem('hero_tab_switch_count', String(tabSwitchCount));
  localStorage.setItem('hero_settings_open_count', String(settingsOpenCount));
}

/* =========================
   Helpers achievements
   ========================= */
function isUnlocked(id){ return unlocked.includes(id); }
function unlock(id){
  if(!isUnlocked(id)){
    unlocked.push(id);
    saveState();
    renderAchievements(); // обновить UI
    // эффект подсветки
    const el = document.querySelector(`.achievement-card[data-id="${id}"]`);
    if(el){ el.classList.add('achievement-unlocked'); setTimeout(()=>el.classList.remove('achievement-unlocked'), 1400); }
  }
}

/* =========================
   Render functions
   ========================= */

function renderMobs(){
  const q = searchEl.value.trim().toLowerCase();
  const w = worldFilterEl.value;
  cardsEl.innerHTML = '';

  const order = ['Даливарика','Миср','Алотерра','Междумирье'];
  order.forEach(worldName => {
    const list = enemies.filter(e => e.world === worldName);
    list.forEach(e => {
      if((w === 'all' || e.world === w) && e.name.toLowerCase().includes(q)){
        const div = document.createElement('div');
        div.className = 'card';
        div.tabIndex = 0;
        let html = `<h3>${e.order}. ${e.name}</h3><div class="world">Мир: ${e.world}</div>`;
        html += e.drops.map(d => `<div class="stat">• ${d}</div>`).join('');
        if(fanMode && e.fan){
          html += `<div class="fan-desc">${e.fan}</div>`;
        }
        div.innerHTML = html;

        div.addEventListener('click', ()=>{
          viewedMobs.add(e.name);
          clickCount++;
          saveState();
          checkAchievements();
        });
        div.addEventListener('keydown', (ev)=>{
          if(ev.key === 'Enter' || ev.key === ' '){ div.click(); ev.preventDefault(); }
        });

        cardsEl.appendChild(div);
      }
    });
  });
}

function renderItems(){
  itemsGridEl.innerHTML = '';
  items.forEach(it=>{
    const div = document.createElement('div');
    div.className = 'item-card';
    div.tabIndex = 0;
    div.innerHTML = `<h3>${it.name}</h3><div class="small">${it.desc}</div>`;
    div.addEventListener('click', ()=>{
      viewedItems.add(it.id);
      clickCount++;
      saveState();
      checkAchievements();
    });
    div.addEventListener('keydown',(ev)=>{
      if(ev.key==='Enter' || ev.key===' '){ div.click(); ev.preventDefault(); }
    });
    itemsGridEl.appendChild(div);
  });
}

function renderAchievements(){
  achievementsGridEl.innerHTML = '';
  if(!showAchievements){
    achievementsGridEl.innerHTML = `<div class="small">Вкладка достижений скрыта (Настройки → Показывать вкладку «Достижения»).</div>`;
    achievementsInfoEl.textContent = `Открыто ${unlocked.length} из ${achievements.length}`;
    return;
  }

  achievements.forEach(a=>{
    const div = document.createElement('div');
    div.className = 'achievement-card' + (isUnlocked(a.id) ? ' achievement-unlocked' : ' achievement-locked');
    div.dataset.id = a.id;
    let title = a.name;
    let inner = `<h3>${title}</h3>`;
    if(!a.secret && a.req) inner += `<div class="small">${a.req}</div>`;
    else inner += `<div class="small">Секретное достижение — условие не отображается</div>`;
    inner += `<div class="small">Статус: ${isUnlocked(a.id) ? 'Открыто' : 'Закрыто'}</div>`;
    div.innerHTML = inner;
    achievementsGridEl.appendChild(div);
  });
  achievementsInfoEl.textContent = `Открыто ${unlocked.length} из ${achievements.length} достижений.`;
}

/* =========================
   Achievements checks (примитивные проверки)
   ========================= */

function checkAchievements(){
  const vm = viewedMobs.size;
  const vi = viewedItems.size;

  if(vm >= 1) unlock('a1');
  if(vi >= 1) unlock('a2');
  if(document.querySelector('.tab[data-tab="prestige"]').classList.contains('active')) unlock('a3');
  if(vm >= 6) unlock('a4');
  if(vi >= 5) unlock('a5');
  if(vi >= items.length) unlock('a6');
  if(fanMode) unlock('a7');
  if(settingsPanel.classList.contains('active')) unlock('a8');
  if(searchEl.value.trim().length > 0) unlock('a9');
  if(worldFilterEl.value !== 'all') unlock('a10');
  if(vm >= 10) unlock('a11');
  if(tabSwitchCount >= 10) unlock('a12');
  // a13: viewed all mobs of currently filtered world
  if(worldFilterEl.value !== 'all'){
    const totalInWorld = enemies.filter(e=>e.world===worldFilterEl.value).length;
    const viewedInWorld = enemies.filter(e=>e.world===worldFilterEl.value && viewedMobs.has(e.name)).length;
    if(viewedInWorld === totalInWorld) unlock('a13');
  }
  if(vm >= 12) unlock('a14');
  if(vm >= 18) unlock('a15');
  if(typeof window._prestigeVisitCount !== 'undefined' && window._prestigeVisitCount >= 5) unlock('a16');
  if(vm >= 20) unlock('a17');
  if(vi >= 10) unlock('a19');
  if(vm >= enemies.length) unlock('a21');
  if(vi >= items.length) unlock('a22');
  if(fanMode && vm >= 10) unlock('a23');
  if(clickCount >= 50) unlock('a26');
  if(tabSwitchCount >= 20) unlock('a33');
  if(clickCount >= 100) unlock('a37');
  if(settingsOpenCount >= 10) unlock('a38');
  if((vi + vm) >= 30) unlock('a34');
  if(vi >= 18) unlock('a40');

  // secrets: demo triggers
  if(fanMode && vm >= enemies.length) unlock('s1');
  if(clickCount >= 250) unlock('s2');
  if(fanMode && tabSwitchCount > 50) unlock('s3');
  if(vi >= 15 && vm >= 15) unlock('s4');

  saveState();
}

/* =========================
   Tab logic
   ========================= */
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    // if tab is hidden, ignore
    if(btn.classList.contains('hidden')) return;
    document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    const content = document.getElementById('tab-' + btn.dataset.tab);
    if(content) content.classList.add('active');
    tabSwitchCount++; localStorage.setItem('hero_tab_switch_count', String(tabSwitchCount));
    if(btn.dataset.tab === 'items') renderItems();
    if(btn.dataset.tab === 'achievements') renderAchievements();
    if(btn.dataset.tab === 'prestige'){ window._prestigeVisitCount = (window._prestigeVisitCount||0) + 1; }
    checkAchievements();
  });
});

/* =========================
   Settings toggles and panel
   ========================= */
openSettingsBtn.addEventListener('click', ()=>{
  const active = settingsPanel.classList.toggle('active');
  settingsPanel.setAttribute('aria-hidden', active ? 'false' : 'true');
  settingsOpenCount++; localStorage.setItem('hero_settings_open_count', String(settingsOpenCount));
  checkAchievements();
});

fanModeToggle.addEventListener('change', (e)=>{
  fanMode = !!e.target.checked;
  saveState();
  renderMobs();
  checkAchievements();
  renderAchievements();
});

showAchievementsToggle.addEventListener('change', (e)=>{
  showAchievements = !!e.target.checked;
  saveState();
  updateAchievementsTabVisibility();
});

/* =========================
   Code input handling
   ========================= */

promoBtn.addEventListener('click', ()=>{
  const raw = (promoInput.value || '').trim();
  if(!raw){ codeMessage.textContent = 'Введите код.'; return; }
  // normalized key (case-sensitive per mapping; allow lowercase input)
  const keyLower = raw;
  // admin-code special
  if(keyLower === adminCode){
    if(isUnlocked('a46')){ codeMessage.textContent = 'Достижение «Админ» уже получено.'; promoInput.value=''; return; }
    unlock('a46');
    usedCodes.add(adminCode);
    saveState();
    codeMessage.textContent = 'Код принят — вы получили достижение «Админ».';
    promoInput.value='';
    return;
  }
  // find matching code in codeMap (case-insensitive)
  let matched = null;
  for(const k in codeMap){
    if(k.toLowerCase() === keyLower.toLowerCase()){
      matched = k; break;
    }
  }
  if(!matched){
    codeMessage.textContent = 'Код не найден или неправильный.';
    return;
  }
  const achId = codeMap[matched];
  if(usedCodes.has(matched) || isUnlocked(achId)){
    codeMessage.textContent = 'Этот код уже использован.';
    promoInput.value='';
    return;
  }
  // unlock and mark used
  unlock(achId);
  usedCodes.add(matched);
  saveState();
  codeMessage.textContent = 'Код принят — достижение выдано.';
  promoInput.value='';
});

/* =========================
   Confirm "I wrote to bot" -> unlock helper (a47)
   ========================= */
confirmMessagedBot.addEventListener('click', ()=>{
  if(isUnlocked('a47')){ alert('Достижение «Помощник» уже получено.'); return; }
  // user confirms they messaged bot
  unlock('a47');
  saveState();
  alert('Спасибо! Достижение «Помощник» выдано.');
});

/* =========================
   Achievements tab visibility
   ========================= */
function updateAchievementsTabVisibility(){
  const tabBtn = document.querySelector('.tab[data-tab="achievements"]');
  if(!showAchievements){
    tabBtn.classList.add('hidden');
    if(tabBtn.classList.contains('active')){
      document.querySelector('.tab[data-tab="mobs"]').click();
    }
  } else {
    tabBtn.classList.remove('hidden');
  }
}

/* =========================
   Misc bindings & initial render
   ========================= */
searchEl.addEventListener('input', ()=>{ renderMobs(); checkAchievements(); });
worldFilterEl.addEventListener('change', ()=>{ renderMobs(); checkAchievements(); });

document.addEventListener('click', (e)=>{
  if(!e.target.closest('.settingsPanel')){ clickCount++; saveState(); checkAchievements(); }
});

function initialRender(){
  renderMobs();
  renderItems();
  renderAchievements();
  checkAchievements();
  updateAchievementsTabVisibility();
}
initialRender();

/* =========================
   Small keyboard accessibility
   ========================= */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape' && settingsPanel.classList.contains('active')){
    settingsPanel.classList.remove('active');
    settingsPanel.setAttribute('aria-hidden','true');
  }
});
</script>
</body>
</html>
